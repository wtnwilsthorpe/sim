<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCSE Physics: Stopping Distance Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        canvas {
            image-rendering: pixelated;
        }
        .distance-bar {
            transition: width 0.5s ease-out;
        }
        #simContainer {
            transition: filter 0.5s ease;
        }
        .low-visibility {
            filter: brightness(0.4) contrast(1.2);
        }
    </style>
</head>
<body class="bg-slate-900 text-white font-sans min-h-screen">

    <div class="max-w-5xl mx-auto p-4 md:p-8">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-blue-400 mb-2">Stopping Distance Simulator</h1>
            <p class="text-slate-400 italic">Total Distance = Thinking Distance + Braking Distance</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Controls Sidebar -->
            <div class="bg-slate-800 p-6 rounded-2xl shadow-xl space-y-6">
                <h2 class="text-xl font-semibold border-b border-slate-700 pb-2">Variables</h2>
                
                <!-- Speed -->
                <div>
                    <label class="block text-sm font-medium mb-1">Speed: <span id="speedVal" class="text-blue-400">30</span> mph</label>
                    <input type="range" id="speed" min="10" max="70" step="10" value="30" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                </div>

                <!-- Thinking Factors -->
                <div class="space-y-4">
                    <h3 class="text-sm font-bold text-slate-500 uppercase">Thinking Factors</h3>
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="checkbox" id="distracted" class="w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded">
                        <span class="text-sm">Driver Distracted (Phone/Tired)</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="checkbox" id="visibility" class="w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded">
                        <span class="text-sm">Poor Visibility (Fog/Night)</span>
                    </label>
                </div>

                <!-- Braking Factors -->
                <div class="space-y-4">
                    <h3 class="text-sm font-bold text-slate-500 uppercase">Braking Factors</h3>
                    <div>
                        <label class="block text-xs mb-1">Road Condition</label>
                        <select id="road" class="w-full bg-slate-700 border border-slate-600 rounded px-2 py-1 text-sm">
                            <option value="1">Dry Asphalt</option>
                            <option value="1.5">Wet Road</option>
                            <option value="2.5">Icy Road</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs mb-1">Brake/Tyre Condition</label>
                        <select id="brakes" class="w-full bg-slate-700 border border-slate-600 rounded px-2 py-1 text-sm">
                            <option value="1">New / Well Maintained</option>
                            <option value="1.4">Worn Tyres / Faulty Brakes</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs mb-1">Vehicle Mass</label>
                        <select id="mass" class="w-full bg-slate-700 border border-slate-600 rounded px-2 py-1 text-sm">
                            <option value="1">Standard Car</option>
                            <option value="1.5">Full Load / SUV</option>
                            <option value="3">Heavy Lorry</option>
                        </select>
                    </div>
                </div>

                <button id="startBtn" class="w-full py-4 bg-red-600 hover:bg-red-500 rounded-xl font-bold text-lg transition-colors shadow-lg">
                    EMERGENCY STOP!
                </button>
                <button id="resetBtn" class="w-full py-2 bg-slate-700 hover:bg-slate-600 rounded-xl font-medium text-sm transition-colors text-slate-300">
                    Reset Scene
                </button>
            </div>

            <!-- Simulation Area -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Canvas Container -->
                <div id="simContainer" class="relative bg-slate-300 rounded-2xl overflow-hidden h-64 shadow-inner border-4 border-slate-800">
                    <canvas id="simCanvas"></canvas>
                    <div id="distanceMarker" class="absolute top-2 left-2 bg-black/50 px-3 py-1 rounded text-xs">
                        0m
                    </div>
                </div>

                <!-- Results & Data -->
                <div class="bg-slate-800 p-6 rounded-2xl shadow-xl">
                    <h2 class="text-xl font-semibold mb-4">Stopping Distance Breakdown</h2>
                    
                    <!-- Graph bars -->
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between text-sm mb-1 text-blue-300">
                                <span>Thinking Distance</span>
                                <span id="thinkLabel">0 m</span>
                            </div>
                            <div class="w-full bg-slate-700 h-6 rounded-full overflow-hidden">
                                <div id="thinkBar" class="distance-bar h-full bg-blue-500 w-0"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between text-sm mb-1 text-red-300">
                                <span>Braking Distance</span>
                                <span id="brakeLabel">0 m</span>
                            </div>
                            <div class="w-full bg-slate-700 h-6 rounded-full overflow-hidden">
                                <div id="brakeBar" class="distance-bar h-full bg-red-500 w-0"></div>
                            </div>
                        </div>

                        <div class="pt-4 border-t border-slate-700">
                            <div class="flex justify-between text-xl font-bold">
                                <span>Total Stopping Distance</span>
                                <span id="totalLabel" class="text-yellow-400">0 m</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Educational Info -->
                <div id="explanation" class="hidden bg-blue-900/30 border border-blue-500/50 p-4 rounded-xl text-sm leading-relaxed">
                    <p><strong>Physics Insight:</strong> Thinking distance is <em>directly proportional</em> to speed ($d = v \times t$). Braking distance is proportional to <em>speed squared</em> ($d \propto v^2$) because the car's kinetic energy ($\frac{1}{2}mv^2$) must be removed by the work done by the brakes.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const simContainer = document.getElementById('simContainer');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');

        // Inputs
        const speedInput = document.getElementById('speed');
        const distractedInput = document.getElementById('distracted');
        const visibilityInput = document.getElementById('visibility');
        const roadInput = document.getElementById('road');
        const brakesInput = document.getElementById('brakes');
        const massInput = document.getElementById('mass');

        // Labels
        const speedValLabel = document.getElementById('speedVal');
        const thinkLabel = document.getElementById('thinkLabel');
        const brakeLabel = document.getElementById('brakeLabel');
        const totalLabel = document.getElementById('totalLabel');
        const thinkBar = document.getElementById('thinkBar');
        const brakeBar = document.getElementById('brakeBar');

        let animationId;
        let carX = 50;
        let isBraking = false;
        let isFinished = false;
        let startTime = 0;
        let reactionPoint = 0;
        let simulationActive = false;

        // Visual constants
        const ROAD_Y = 180;
        const BASE_CAR_WIDTH = 60;
        const BASE_CAR_HEIGHT = 20;
        const SCALE = 5; // Pixels per meter

        function resize() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            drawScene();
        }

        window.addEventListener('resize', resize);
        setTimeout(resize, 100);

        function updateVisuals() {
            // Visibility effect
            if (visibilityInput.checked) {
                simContainer.classList.add('low-visibility');
            } else {
                simContainer.classList.remove('low-visibility');
            }
            updateLabels();
            drawScene();
        }

        visibilityInput.addEventListener('change', updateVisuals);
        roadInput.addEventListener('change', drawScene);
        massInput.addEventListener('change', drawScene);

        function drawScene() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw Road
            const roadType = roadInput.value;
            if (roadType === "1") ctx.fillStyle = '#475569'; // Dry
            else if (roadType === "1.5") ctx.fillStyle = '#1e293b'; // Wet (Darker)
            else ctx.fillStyle = '#64748b'; // Icy (Lighter/Grey)
            
            ctx.fillRect(0, ROAD_Y, canvas.width, 40);

            // Special Road Textures
            if (roadType === "1.5") { // Wet reflections
                ctx.fillStyle = 'rgba(255,255,255,0.1)';
                for(let i=0; i<canvas.width; i+=40) {
                    ctx.fillRect(i, ROAD_Y, 20, 5);
                }
            } else if (roadType === "2.5") { // Icy patches
                ctx.fillStyle = 'rgba(255,255,255,0.4)';
                for(let i=0; i<canvas.width; i+=60) {
                    ctx.beginPath();
                    ctx.ellipse(i, ROAD_Y + 20, 20, 5, 0, 0, Math.PI*2);
                    ctx.fill();
                }
            }
            
            // Road Lines
            ctx.strokeStyle = '#fff';
            ctx.setLineDash([20, 20]);
            ctx.beginPath();
            ctx.moveTo(0, ROAD_Y + 20);
            ctx.lineTo(canvas.width, ROAD_Y + 20);
            ctx.stroke();
            ctx.setLineDash([]);

            // Scale car based on mass
            const massFactor = parseFloat(massInput.value);
            // We scale height and width slightly differently to show "bulk"
            const carScale = 1 + (massFactor - 1) * 0.3; 
            const carWidth = BASE_CAR_WIDTH * carScale;
            const carHeight = BASE_CAR_HEIGHT * carScale;
            const roofHeight = 15 * carScale;

            // Draw Car
            ctx.fillStyle = isBraking ? '#ef4444' : '#3b82f6';
            // Body
            ctx.fillRect(carX, ROAD_Y - carHeight - 5, carWidth, carHeight);
            ctx.fillRect(carX + (10 * carScale), ROAD_Y - carHeight - roofHeight - 5, carWidth * 0.6, roofHeight);
            
            // Wheels
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(carX + (15 * carScale), ROAD_Y - 5, 8 * carScale, 0, Math.PI * 2);
            ctx.arc(carX + carWidth - (15 * carScale), ROAD_Y - 5, 8 * carScale, 0, Math.PI * 2);
            ctx.fill();

            // Reaction Flag
            if (reactionPoint > 0) {
                ctx.strokeStyle = '#3b82f6';
                ctx.beginPath();
                ctx.moveTo(reactionPoint, ROAD_Y - 100);
                ctx.lineTo(reactionPoint, ROAD_Y);
                ctx.stroke();
                ctx.fillStyle = '#3b82f6';
                ctx.font = "bold 12px sans-serif";
                ctx.fillText("SEE HAZARD", reactionPoint + 5, ROAD_Y - 90);
            }

            // Braking Point
            if (isBraking) {
                const brakeStart = reactionPoint + (calculatedThinkingDist * SCALE);
                ctx.strokeStyle = '#ef4444';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(brakeStart, ROAD_Y - 100);
                ctx.lineTo(brakeStart, ROAD_Y);
                ctx.stroke();
                ctx.setLineDash([]);
                ctx.fillStyle = '#ef4444';
                ctx.fillText("BRAKES APPLIED", brakeStart + 5, ROAD_Y - 70);
            }
        }

        let calculatedThinkingDist = 0;
        let calculatedBrakingDist = 0;

        function updateLabels() {
            speedValLabel.innerText = speedInput.value;
        }

        speedInput.addEventListener('input', updateLabels);

        function runSimulation() {
            if (simulationActive) return;
            
            simulationActive = true;
            isBraking = false;
            isFinished = false;
            
            const speedMph = parseInt(speedInput.value);
            const speedMs = speedMph * 0.44704; 
            
            let reactionTime = 0.7;
            if (distractedInput.checked) reactionTime += 0.8;
            if (visibilityInput.checked) reactionTime += 0.5;
            
            let deceleration = 7;
            deceleration /= parseFloat(roadInput.value);
            deceleration /= parseFloat(brakesInput.value);
            deceleration /= parseFloat(massInput.value);

            calculatedThinkingDist = speedMs * reactionTime;
            calculatedBrakingDist = (speedMs * speedMs) / (2 * deceleration);
            
            const totalDist = calculatedThinkingDist + calculatedBrakingDist;

            carX = 20;
            reactionPoint = 100;
            thinkBar.style.width = '0%';
            brakeBar.style.width = '0%';
            thinkLabel.innerText = '0 m';
            brakeLabel.innerText = '0 m';
            totalLabel.innerText = '0 m';
            document.getElementById('explanation').classList.add('hidden');

            let state = 'cruising'; 
            let lastTime = performance.now();
            let currentSpeed = speedMs;

            function animate(now) {
                const dt = (now - lastTime) / 1000;
                lastTime = now;

                if (state === 'cruising') {
                    carX += speedMs * dt * SCALE;
                    if (carX >= reactionPoint) {
                        state = 'thinking';
                        startTime = now;
                    }
                } else if (state === 'thinking') {
                    carX += speedMs * dt * SCALE;
                    const timeInThinking = (now - startTime) / 1000;
                    
                    const currentThink = Math.min(speedMs * timeInThinking, calculatedThinkingDist);
                    const pct = (currentThink / totalDist) * 100;
                    thinkBar.style.width = `${pct}%`;
                    thinkLabel.innerText = `${currentThink.toFixed(1)} m`;

                    if (timeInThinking >= reactionTime) {
                        state = 'braking';
                        isBraking = true;
                        startTime = now;
                    }
                } else if (state === 'braking') {
                    const timeInBraking = (now - startTime) / 1000;
                    currentSpeed = Math.max(0, speedMs - (deceleration * timeInBraking));
                    carX += currentSpeed * dt * SCALE;

                    const currentBrake = Math.min(calculatedBrakingDist, (speedMs**2 - currentSpeed**2)/(2*deceleration));
                    const brakePct = (currentBrake / totalDist) * 100;
                    
                    brakeBar.style.width = `${brakePct}%`;
                    brakeLabel.innerText = `${currentBrake.toFixed(1)} m`;
                    totalLabel.innerText = `${(calculatedThinkingDist + currentBrake).toFixed(1)} m`;

                    if (currentSpeed <= 0) {
                        state = 'stopped';
                        isFinished = true;
                        simulationActive = false;
                        document.getElementById('explanation').classList.remove('hidden');
                    }
                }

                drawScene();
                if (state !== 'stopped') {
                    animationId = requestAnimationFrame(animate);
                }
            }

            requestAnimationFrame(animate);
        }

        startBtn.addEventListener('click', runSimulation);
        resetBtn.addEventListener('click', () => {
            cancelAnimationFrame(animationId);
            simulationActive = false;
            carX = 50;
            reactionPoint = 0;
            isBraking = false;
            isFinished = false;
            thinkBar.style.width = '0%';
            brakeBar.style.width = '0%';
            thinkLabel.innerText = '0 m';
            brakeLabel.innerText = '0 m';
            totalLabel.innerText = '0 m';
            document.getElementById('explanation').classList.add('hidden');
            drawScene();
        });

        drawScene();
    </script>
</body>
</html>